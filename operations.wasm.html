<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="./favicon.ico" />
    <!-- Preload is necessary because we show these images when we disconnect from the server,
    but at that point we cannot load these images from the server -->
    <link rel="preload" href="./assets/gradient-yHQUC_QB.png" as="image" />
    <link rel="preload" href="./assets/noise-60BoTA8O.png" as="image" />
    <!-- Preload the fonts -->
    <link rel="preload" href="./assets/Lora-VariableFont_wght-B2ootaw-.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/PTSans-Regular-CxL0S8W7.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/PTSans-Bold-D9fedIX3.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/FiraMono-Regular-BTCkDNvf.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/FiraMono-Medium-DU3aDxX5.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/FiraMono-Bold-CLVRCuM9.ttf" as="font" crossorigin="anonymous" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="a marimo app" />
    <link rel="apple-touch-icon" href="./apple-touch-icon.png" />
    <link rel="manifest" href="./manifest.json" />

    <script data-marimo="true">
      function __resizeIframe(obj) {
        var scrollbarHeight = 20; // Max between windows, mac, and linux

        function setHeight() {
          var element = obj.contentWindow.document.documentElement;
          // If there is no vertical scrollbar, we don't need to resize the iframe
          if (element.scrollHeight === element.clientHeight) {
            return;
          }

          // Create a new height that includes the scrollbar height if it's visible
          var hasHorizontalScrollbar = element.scrollWidth > element.clientWidth;
          var newHeight = element.scrollHeight + (hasHorizontalScrollbar ? scrollbarHeight : 0);

          // Only update the height if it's different from the current height
          if (obj.style.height !== `${newHeight}px`) {
            obj.style.height = `${newHeight}px`;
          }
        }

        // Resize the iframe to the height of the content and bottom scrollbar height
        setHeight();

        // Resize the iframe when the content changes
        const resizeObserver = new ResizeObserver((entries) => {
          setHeight();
        });
        resizeObserver.observe(obj.contentWindow.document.body);
      }
    </script>
    <marimo-filename hidden>notebook.py</marimo-filename>
    <!-- TODO(Trevor): Legacy, required by VS Code plugin. Remove when plugin is updated (see marimo/server/_templates/template.py) -->
    <marimo-version data-version="{{ version }}" hidden></marimo-version>
    <marimo-user-config data-config="{{ user_config }}" hidden></marimo-user-config>
    <marimo-server-token data-token="{{ server_token }}" hidden></marimo-server-token>
    <!-- /TODO -->
    <title>operations</title>
    <script type="module" crossorigin src="./assets/index-DKEudB02.js"></script>
    <link rel="stylesheet" crossorigin href="./assets/index-Cx0bsY1w.css">
  <marimo-wasm hidden=""></marimo-wasm>
    <script>
        if (window.location.protocol === 'file:') {
            alert('Warning: This file must be served by an HTTP server to function correctly.');
        }
    </script>
    
    <style>
        #save-button {
            display: none !important;
        }
        #filename-input {
            display: none !important;
        }
    </style>
    <marimo-code hidden="">import%20marimo%0A%0A__generated_with%20%3D%20%220.16.0%22%0Aapp%20%3D%20marimo.App(width%3D%22medium%22)%0A%0Awith%20app.setup%3A%0A%20%20%20%20%23%20Initialization%20code%20that%20runs%20before%20all%20other%20cells%0A%20%20%20%20import%20marimo%20as%20mo%0A%20%20%20%20import%20polars%20as%20pl%0A%20%20%20%20from%20utils%20import%20google_sheet%20as%20gs%0A%20%20%20%20from%20utils.date_widget%20import%20DateDropdownWidget%0A%20%20%20%20from%20datetime%20import%20date%2Cdatetime%0A%20%20%20%20import%20logging%0A%0A%20%20%20%20from%20typing%20import%20Optional%0A%0A%0A%40app.cell%0Adef%20logger()%3A%0A%20%20%20%20%23%20Configure%20logging%20for%20better%20error%20tracking%0A%20%20%20%20logging.basicConfig(level%3Dlogging.INFO)%0A%20%20%20%20logger%20%3D%20logging.getLogger(__name__)%0A%20%20%20%20return%20(logger%2C)%0A%0A%0A%40app.cell%0Adef%20loadgooglesheetdata(logger)%3A%0A%20%20%20%20%23%20Initialize%20the%20Google%20Sheets%20loader%20with%20error%20handling%0A%20%20%20%20try%3A%0A%20%20%20%20%20%20%20%20gsheet%20%3D%20gs.GoogleSheetsLoader()%0A%20%20%20%20%20%20%20%20operations_raw_data%20%3D%20gsheet.load_sheet(config_name%3D%22Operations_Activity%22).data%0A%20%20%20%20%20%20%20%20customers%20%3D%20gsheet.load_sheet(config_name%3D%22customer%22).data%0A%20%20%20%20%20%20%20%20transfer%20%3D%20gsheet.load_sheet(config_name%3D%22Transfer%22).data%0A%20%20%20%20%20%20%20%20logger.info(%22Successfully%20loaded%20data%20from%20Google%20Sheets%22)%0A%20%20%20%20except%20Exception%20as%20e%3A%0A%20%20%20%20%20%20%20%20logger.error(f%22Failed%20to%20load%20data%3A%20%7Be%7D%22)%0A%20%20%20%20%20%20%20%20mo.stop(%22%E2%9D%8C%20Failed%20to%20load%20data%20from%20Google%20Sheets.%20Please%20check%20your%20connection.%22)%0A%20%20%20%20return%20customers%2C%20operations_raw_data%2C%20transfer%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20%23%20Unique%20containers%0A%0A%0A%20%20%20%20def%20transfer_clean(df%3A%20pl.LazyFrame)%20-%3E%20pl.LazyFrame%3A%0A%20%20%20%20%20%20%20%20%22%22%22Transfer%20dataset%22%22%22%0A%20%20%20%20%20%20%20%20return%20df.select(pl.col(%22container_number%22)%2C%20pl.col(%22line%22)).unique()%0A%0A%0A%20%20%20%20def%20iot_soc(df%3A%20pl.LazyFrame)%20-%3E%20pl.LazyFrame%3A%0A%20%20%20%20%20%20%20%20%22%22%22IOT%20SOC%20containers%22%22%22%0A%20%20%20%20%20%20%20%20return%20df.filter(pl.col(%22line%22).eq(%22IOT%22)).drop(%22line%22)%0A%0A%0A%20%20%20%20def%20container_stuffing(df%3A%20pl.LazyFrame)%20-%3E%20pl.LazyFrame%3A%0A%20%20%20%20%20%20%20%20%22%22%22Container%20numbers%22%22%22%0A%20%20%20%20%20%20%20%20return%20df.filter(pl.col(%22line%22).ne(%22IOT%22)).drop(%22line%22)%0A%20%20%20%20return%20container_stuffing%2C%20iot_soc%2C%20transfer_clean%0A%0A%0A%40app.cell%0Adef%20_(container_stuffing%2C%20iot_soc%2C%20transfer%2C%20transfer_clean)%3A%0A%20%20%20%20iot_soc_unique%20%3D%20iot_soc(transfer_clean(df%3Dtransfer)).collect().to_series().to_list()%0A%20%20%20%20container_unique%20%3D%20container_stuffing(transfer_clean(df%3Dtransfer)).collect().to_series().to_list()%0A%20%20%20%20return%20container_unique%2C%20iot_soc_unique%0A%0A%0A%40app.cell%0Adef%20_(logger)%3A%0A%20%20%20%20def%20clean_ops_data(df%3A%20pl.LazyFrame)%20-%3E%20pl.LazyFrame%3A%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20Clean%20and%20transform%20operations%20data%20with%20enhanced%20error%20handling%0A%0A%20%20%20%20%20%20%20%20Args%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20df%3A%20Raw%20operations%20data%20from%20Google%20Sheets%0A%0A%20%20%20%20%20%20%20%20Returns%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20Cleaned%20LazyFrame%20with%20standardized%20columns%20and%20data%20types%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20try%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20df.select(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20pl.col(%22Day%22)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20pl.col(%22Date%22).alias(%22date%22).cast(pl.Date%2C%20strict%3DFalse)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20pl.col(%22Time%22).alias(%22time%22).cast(pl.Time%2C%20strict%3DFalse)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20pl.col(%22Vessel%22).str.to_uppercase().alias(%22vessel%22)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20pl.col(%22Species%22).str.extract(r%22%5E(.*%3F)(%5Cs-%5Cs%7C%24)%22).alias(%22species%22)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20pl.col(%22Details%22).str.to_uppercase().alias(%22details%22)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20Enhanced%20tonnage%20calculation%20with%20better%20error%20handling%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(pl.col(%22Scale%20Reading(-Fish%20Net)%20(Cal)%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.str.replace_all(%22%2C%22%2C%20%22%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.str.replace_all(r%22%5B%5E%5Cd.%5D%22%2C%20%22%22)%20%20%23%20Remove%20non-numeric%20characters%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.cast(pl.Float64%2C%20strict%3DFalse)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.fill_null(0)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.alias(%22tonnage_kg%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20*%200.001).round(3).alias(%22tonnage%22)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20pl.col(%22Storage%22).cast(dtype%3Dpl.Enum(%5B%22Brine%22%2C%20%22Dry%22%5D)%2C%20strict%3DFalse)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20pl.col(%22Container%20(Destination)%22).str.to_uppercase().alias(%22destination%22)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20pl.col(%22overtime%22)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20pl.col(%22Side%20Working%22).alias(%22side_working%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20).filter(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20Filter%20out%20invalid%20records%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20pl.col(%22date%22).is_not_null()%20%26%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20pl.col(%22vessel%22).is_not_null()%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20pl.col(%22tonnage%22).ge(0)%0A%20%20%20%20%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20except%20Exception%20as%20e%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20logger.error(%22Error%20cleaning%20operations%20data%3A%20%25s%22%2Ce)%0A%20%20%20%20%20%20%20%20%20%20%20%20raise%20%20pl.col(%22Side%20Working%22).alias(%22side_working%22)%0A%20%20%20%20return%20(clean_ops_data%2C)%0A%0A%0A%40app.cell%0Adef%20_(clean_ops_data%2C%20operations_raw_data)%3A%0A%20%20%20%20operation_dataset%20%3D%20clean_ops_data(operations_raw_data).collect()%0A%20%20%20%20return%20(operation_dataset%2C)%0A%0A%0A%40app.function%0Adef%20clean_customers(df%3A%20pl.LazyFrame%2C%20vessel_kind%3A%20list%5Bstr%5D)%20-%3E%20list%5Bstr%5D%3A%0A%20%20%20%20%22%22%22Clean%20the%20customer%20dataset%22%22%22%0A%20%20%20%20return%20(%0A%20%20%20%20%20%20%20%20df.filter(pl.col(%22Type%22).is_in(vessel_kind))%0A%20%20%20%20%20%20%20%20.select(pl.col(%22Vessel%2FClient%22))%0A%20%20%20%20%20%20%20%20.collect()%0A%20%20%20%20%20%20%20%20.to_series()%0A%20%20%20%20%20%20%20%20.to_list()%0A%20%20%20%20)%0A%0A%0A%40app.cell%0Adef%20_(logger)%3A%0A%0A%20%20%20%20def%20date_string_to_date(date_string%3A%20str)%20-%3E%20Optional%5Bdate%5D%3A%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20Convert%20date%20string%20to%20date%20object%20with%20multiple%20format%20support%0A%0A%20%20%20%20%20%20%20%20Args%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20date_string%3A%20Date%20string%20in%20various%20formats%0A%0A%20%20%20%20%20%20%20%20Returns%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20date%20object%20or%20None%20if%20conversion%20fails%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20if%20not%20date_string%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20None%0A%0A%20%20%20%20%20%20%20%20formats%20%3D%20%5B%22%25d%2F%25m%2F%25Y%22%2C%20%22%25Y-%25m-%25d%22%2C%20%22%25m%2F%25d%2F%25Y%22%2C%20%22%25d-%25m-%25Y%22%5D%0A%0A%20%20%20%20%20%20%20%20for%20fmt%20in%20formats%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20try%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20datetime.strptime(date_string%2C%20fmt).date()%0A%20%20%20%20%20%20%20%20%20%20%20%20except%20ValueError%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue%0A%0A%20%20%20%20%20%20%20%20logger.warning(f%22Could%20not%20parse%20date%20string%3A%20%7Bdate_string%7D%22)%0A%20%20%20%20%20%20%20%20return%20None%0A%20%20%20%20return%20(date_string_to_date%2C)%0A%0A%0A%40app.cell%0Adef%20_(customers)%3A%0A%20%20%20%20%23%20Create%20enhanced%20vessel%20dropdown%0A%20%20%20%20vessel_options%20%3D%20clean_customers(customers%2C%20%5B%22THONIER%22%2C%20%22LONGLINER%22%2C%20%22CARGO%22%5D)%0A%0A%20%20%20%20if%20not%20vessel_options%3A%0A%20%20%20%20%20%20%20%20mo.stop(%22%E2%9D%8C%20No%20vessels%20found%20in%20the%20customer%20data%22)%0A%0A%20%20%20%20vessel_dropdown%20%3D%20mo.ui.dropdown(%0A%20%20%20%20%20%20%20%20options%3Dvessel_options%2C%0A%20%20%20%20%20%20%20%20searchable%3DTrue%2C%0A%20%20%20%20%20%20%20%20label%3D%22%F0%9F%9A%A2%20Select%20Vessel%22%0A%20%20%20%20)%0A%0A%20%20%20%20%23%20Enhanced%20UI%20layout%0A%20%20%20%20title%20%3D%20mo.md(%22%23%20%F0%9F%93%8A%20Hourly%20Operations%20Analysis%22)%0A%20%20%20%20sub_title%20%3D%20mo.md(%22Select%20a%20vessel%20to%20view%20hourly%20tonnage%20performance%22)%0A%0A%20%20%20%20mo.vstack(%5Btitle%2Csub_title%2Cvessel_dropdown%5D)%0A%20%20%20%20return%20(vessel_dropdown%2C)%0A%0A%0A%40app.cell%0Adef%20_(vessel_dropdown)%3A%0A%0A%0A%0A%0A%20%20%20%20%23%20Stop%20execution%20if%20no%20vessel%20is%20selected%0A%20%20%20%20if%20vessel_dropdown.value%20is%20None%3A%0A%20%20%20%20%20%20%20%20mo.stop(%22%F0%9F%91%86%20Please%20select%20a%20vessel%20to%20continue%22)%0A%0A%20%20%20%20selected_vessel%20%3D%20vessel_dropdown.value%0A%20%20%20%20return%20(selected_vessel%2C)%0A%0A%0A%40app.cell%0Adef%20_(operation_dataset%2C%20selected_vessel)%3A%0A%20%20%20%20%23%20Create%20hourly%20summary%0A%20%20%20%20try%3A%0A%20%20%20%20%20%20%20%20hourly%20%3D%20create_operation_summary(operation_dataset)%0A%20%20%20%20%20%20%20%20filtered_data%20%3D%20hourly.filter(pl.col(%22vessel%22)%20%3D%3D%20selected_vessel)%0A%0A%20%20%20%20%20%20%20%20if%20len(filtered_data)%20%3D%3D%200%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20mo.stop(f%22%E2%9D%8C%20No%20data%20found%20for%20vessel%3A%20%7Bselected_vessel%7D%22)%0A%0A%20%20%20%20%20%20%20%20%23%20Get%20available%20dates%20with%20proper%20formatting%0A%20%20%20%20%20%20%20%20available_dates%20%3D%20(filtered_data%0A%20%20%20%20%20%20%20%20%20%20%20%20.select(pl.col(%22date%22).dt.to_string(%22%25d%2F%25m%2F%25Y%22).unique())%0A%20%20%20%20%20%20%20%20%20%20%20%20.sort(pl.col(%22date%22))%0A%20%20%20%20%20%20%20%20%20%20%20%20.to_series()%0A%20%20%20%20%20%20%20%20%20%20%20%20.to_list()%0A%20%20%20%20%20%20%20%20)%0A%0A%20%20%20%20except%20Exception%20as%20e%3A%0A%20%20%20%20%20%20%20%20mo.stop(f%22%E2%9D%8C%20Error%20processing%20data%20for%20%7Bselected_vessel%7D%3A%20%7Be%7D%22)%0A%0A%20%20%20%20%23%20Enhanced%20date%20dropdown%0A%20%20%20%20date_dropdown%20%3D%20mo.ui.dropdown(%0A%20%20%20%20%20%20%20%20label%3Df%22%F0%9F%93%85%20Available%20dates%20for%20%7Bselected_vessel%7D%20(%7Blen(available_dates)%7D%20days)%22%2C%0A%20%20%20%20%20%20%20%20options%3Davailable_dates%0A%20%20%20%20)%0A%0A%20%20%20%20date_dropdown%0A%20%20%20%20return%20(date_dropdown%2C)%0A%0A%0A%40app.function%0Adef%20create_operation_summary(operation_dataset)%3A%0A%20%20%20%20%23%20First%2C%20get%20the%20pivoted%20data%0A%20%20%20%20base_query%20%3D%20(operation_dataset%0A%20%20%20%20%20%20%20%20.with_columns(pl.col(%22time%22).dt.hour().add(1).alias(%22hour%22))%0A%20%20%20%20%20%20%20%20.group_by(pl.col(%22date%22)%2Cpl.col(%22vessel%22)%2Cpl.col(%22hour%22)%2C%20pl.col(%22side_working%22)%2C%20maintain_order%3DTrue)%0A%20%20%20%20%20%20%20%20.agg(pl.col(%22tonnage%22).sum().round(3))%0A%20%20%20%20%20%20%20%20.pivot(%22side_working%22%2C%20index%3D%5B%22date%22%2C%22vessel%22%2C%22hour%22%5D%2C%20values%3D%22tonnage%22%2C%20aggregate_function%3D%22sum%22)%0A%20%20%20%20%20%20%20%20.sort(by%3D%5B%22date%22%2C%22hour%22%5D)%0A%20%20%20%20)%0A%0A%20%20%20%20%23%20Get%20the%20actual%20columns%20after%20pivot%0A%20%20%20%20actual_columns%20%3D%20base_query.columns%0A%20%20%20%20expected_sides%20%3D%20%5B%22Front%22%2C%20%22Rear%22%2C%20%22Middle%22%5D%0A%0A%20%20%20%20%23%20Create%20expressions%20to%20handle%20missing%20columns%0A%20%20%20%20column_expressions%20%3D%20%5B%5D%0A%20%20%20%20for%20side%20in%20expected_sides%3A%0A%20%20%20%20%20%20%20%20if%20side%20in%20actual_columns%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Column%20exists%2C%20just%20fill%20nulls%20with%200%0A%20%20%20%20%20%20%20%20%20%20%20%20column_expressions.append(pl.col(side).fill_null(0).alias(side))%0A%20%20%20%20%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Column%20doesn't%20exist%2C%20create%20it%20with%200%0A%20%20%20%20%20%20%20%20%20%20%20%20column_expressions.append(pl.lit(0).alias(side))%0A%0A%20%20%20%20%23%20Apply%20the%20column%20expressions%20and%20calculate%20total%0A%20%20%20%20result%20%3D%20base_query.with_columns(column_expressions).with_columns(%0A%20%20%20%20%20%20%20%20pl.sum_horizontal(%5B%22Front%22%2C%22Middle%22%2C%22Rear%22%5D).round(3).alias(%22tonnage_per_hour%22)%0A%20%20%20%20)%0A%0A%20%20%20%20return%20result%0A%0A%0A%40app.cell%0Adef%20_(date_dropdown)%3A%0A%20%20%20%20%23%20Stop%20if%20no%20date%20selected%0A%20%20%20%20if%20date_dropdown.value%20is%20None%3A%0A%20%20%20%20%20%20%20%20mo.stop(%22%F0%9F%91%86%20Please%20select%20a%20date%20to%20view%20hourly%20data%22)%0A%0A%20%20%20%20%23%20Enhanced%20target%20slider%20with%20better%20UI%0A%20%20%20%20target_per_hour%20%3D%20mo.ui.slider(%0A%20%20%20%20%20%20%20%20label%3D%22%F0%9F%8E%AF%20Target%20Tonnage%20Per%20Hour%22%2C%0A%20%20%20%20%20%20%20%20start%3D15%2C%0A%20%20%20%20%20%20%20%20stop%3D40%2C%0A%20%20%20%20%20%20%20%20step%3D1%2C%0A%20%20%20%20%20%20%20%20value%3D25%2C%0A%20%20%20%20%20%20%20%20show_value%3DTrue%0A%20%20%20%20)%0A%0A%20%20%20%20mo.vstack(%5Bmo.md(%22%23%23%23%20Performance%20Settings%22)%2C%0A%20%20%20%20target_per_hour%5D)%0A%20%20%20%20return%20(target_per_hour%2C)%0A%0A%0A%40app.cell%0Adef%20_(operation_dataset%2C%20target_per_hour)%3A%0A%20%20%20%20hourly_%20%3D%20create_operation_summary(operation_dataset%3Doperation_dataset).with_columns((pl.col(%22tonnage_per_hour%22)-pl.lit(target_per_hour.value)).round(1).alias(%22%F0%9F%8E%AF%22))%0A%20%20%20%20return%20(hourly_%2C)%0A%0A%0A%40app.cell%0Adef%20_(date_dropdown%2C%20date_string_to_date%2C%20hourly_%2C%20vessel_dropdown)%3A%0A%20%20%20%20hourly_filtered%20%3D%20hourly_.filter(%0A%20%20%20%20%20%20%20%20pl.col(%22date%22).eq(date_string_to_date(date_dropdown.value))%2C%0A%20%20%20%20%20%20%20%20pl.col(%22vessel%22).eq(vessel_dropdown.value)%2C%0A%20%20%20%20).drop(%5B%22date%22%2C%20%22vessel%22%5D).with_columns(total_tonnage%3Dpl.col(%22tonnage_per_hour%22).cum_sum().round(3))%0A%0A%20%20%20%20mo.ui.table(hourly_filtered)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(date_dropdown%2C%20date_string_to_date%2C%20operation_dataset%2C%20vessel_dropdown)%3A%0A%20%20%20%20import%20polars.selectors%20as%20cs%0A%0A%20%20%20%20daily_%20%3D%20operation_dataset.filter(%0A%20%20%20%20%20%20%20%20pl.col(%22date%22).eq(date_string_to_date(date_dropdown.value))%2C%0A%20%20%20%20%20%20%20%20pl.col(%22vessel%22).eq(vessel_dropdown.value)%2C%0A%20%20%20%20).group_by(%0A%20%20%20%20%20%20%20%20pl.col(%22destination%22)%2C%0A%20%20%20%20%20%20%20%20pl.col(%22species%22)%2C%0A%20%20%20%20%20%20%20%20pl.col(%22Storage%22)%2C%0A%20%20%20%20%20%20%20%20maintain_order%3DTrue%2C%0A%20%20%20%20).agg(pl.col(%22tonnage%22).sum().round(3)).with_columns(%0A%20%20%20%20%20%20%20%20species%3Dpl.col(%22species%22)%20%2B%20%22%5Cn%22%20%2B%20pl.col(%22Storage%22).cast(pl.Utf8)%0A%20%20%20%20).drop(%22Storage%22).pivot(%0A%20%20%20%20%20%20%20%20%22species%22%2C%20index%3D%22destination%22%2C%20values%3D%22tonnage%22%2C%20aggregate_function%3D%22sum%22%0A%20%20%20%20).with_columns(total%3Dpl.sum_horizontal(cs.numeric()).round(3))%0A%20%20%20%20return%20(daily_%2C)%0A%0A%0A%40app.cell%0Adef%20_(daily_%2C%20date_dropdown%2C%20vessel_dropdown)%3A%0A%20%20%20%20date_daily%20%3D%20date_dropdown.value%0A%20%20%20%20vessel_daily%20%3D%20vessel_dropdown.value%0A%0A%0A%20%20%20%20mo.vstack(%0A%20%20%20%20%20%20%20%20%5B%0A%20%20%20%20%20%20%20%20%20%20%20%20mo.md(%22%23%20Daily%20Unloading%20Report%22)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20f%22Vessel%3A%20%7Bvessel_daily%7D%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20f%22Date%3A%20%7Bdate_daily%7D%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20mo.ui.table(daily_)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20mo.md(f%22%23%23%20Total%3A%20%7Bdaily_.select(pl.col(%22total%22).sum().round(3)).to_series().to_list()%5B0%5D%7D%22)%0A%20%20%20%20%20%20%20%20%5D%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(customers)%3A%0A%20%20%20%20cargo_list%20%3D%20clean_customers(customers%2C%20%5B%22CARGO%22%5D)%0A%20%20%20%20return%20(cargo_list%2C)%0A%0A%0A%40app.cell%0Adef%20_(cargo_list%2C%20container_unique%2C%20iot_soc_unique%2C%20operation_dataset)%3A%0A%20%20%20%20def%20operation_with_kind()%20-%3E%20pl.DataFrame%3A%0A%20%20%20%20%20%20%20%20return%20operation_dataset.with_columns(%0A%20%20%20%20%20%20%20%20%20%20%20%20operation_kind%3Dpl.when(pl.col(%22destination%22).is_in(cargo_list))%0A%20%20%20%20%20%20%20%20%20%20%20%20.then(pl.lit(%22Transhipment%22))%0A%20%20%20%20%20%20%20%20%20%20%20%20.when(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(pl.col(%22destination%22).is_in(iot_soc_unique)).or_(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20pl.col(%22destination%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.eq(pl.lit(%22UNLOAD%20TO%20QUAY%22))%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.or_(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20pl.col(%22destination%22).is_in(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5B%22CCCS%20(IOT)%22%2C%20%22CCCS%20(DARDANEL)%22%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20%20%20%20%20.then(pl.lit(%22Simple%20Unloading%22))%0A%20%20%20%20%20%20%20%20%20%20%20%20.when(pl.col(%22destination%22).str.contains(pl.lit(%22CCCS%22)))%0A%20%20%20%20%20%20%20%20%20%20%20%20.then(pl.lit(%22Unload%20to%20CCCS%22))%0A%20%20%20%20%20%20%20%20%20%20%20%20.when(pl.col(%22destination%22).is_in(container_unique))%0A%20%20%20%20%20%20%20%20%20%20%20%20.then(pl.lit(%22Container%20Stuffing%22))%0A%20%20%20%20%20%20%20%20%20%20%20%20.otherwise(pl.col(%22destination%22))%0A%20%20%20%20%20%20%20%20)%0A%20%20%20%20return%20(operation_with_kind%2C)%0A%0A%0A%40app.cell%0Adef%20_(operation_with_kind)%3A%0A%20%20%20%20summarised_ops%20%3D%20operation_with_kind().with_columns(operation_kind%3Dpl.col(%22operation_kind%22)%2B%22%5Cn%22%2Bpl.col(%22Storage%22).cast(pl.Utf8)).group_by(%0A%20%20%20%20%20%20%20%20pl.col(%22operation_kind%22)%2C%0A%20%20%20%20%20%20%20%20%23%20pl.col(%22Storage%22)%2C%0A%20%20%20%20%20%20%20%20pl.col(%22date%22)%2C%0A%20%20%20%20%20%20%20%20pl.col(%22vessel%22)%2C%0A%20%20%20%20%20%20%20%20maintain_order%3DTrue%2C%0A%20%20%20%20).agg(pl.col(%22tonnage%22).sum().round(3)).pivot(%22operation_kind%22%2Cindex%3D%5B%22date%22%2C%22vessel%22%5D%2Cvalues%3D%22tonnage%22%2Caggregate_function%3D%22sum%22)%0A%20%20%20%20return%20(summarised_ops%2C)%0A%0A%0A%40app.cell%0Adef%20_(summarised_ops)%3A%0A%20%20%20%20mo.vstack(%5Bmo.md(%22%23%20Operations%20Activity%22)%2Cmo.ui.table(summarised_ops)%5D)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20return%0A%0A%0Aif%20__name__%20%3D%3D%20%22__main__%22%3A%0A%20%20%20%20app.run()%0A</marimo-code></head>
  <body>
    <div id="root"></div>
    <!-- This is a portal for the data editor to render in -->
    <div id="portal" data-testid="glide-portal" style="position: fixed; left: 0; top: 0; z-index: 9999"></div>
    <script data-marimo="true">
      window.__MARIMO_MOUNT_CONFIG__ = {
            "filename": "notebook.py",
            "mode": "read",
            "version": "0.16.0",
            "serverToken": "unused",
            "config": {"ai": {"models": {"custom_models": [], "displayed_models": []}}, "completion": {"activate_on_typing": true, "copilot": false}, "display": {"cell_output": "below", "code_editor_font_size": 14, "dataframes": "rich", "default_table_max_columns": 50, "default_table_page_size": 10, "default_width": "medium", "reference_highlighting": false, "theme": "light"}, "formatting": {"line_length": 79}, "keymap": {"overrides": {}, "preset": "default"}, "language_servers": {"pylsp": {"enable_flake8": false, "enable_mypy": true, "enable_pydocstyle": false, "enable_pyflakes": false, "enable_pylint": false, "enable_ruff": true, "enabled": true}}, "package_management": {"manager": "pip"}, "runtime": {"auto_instantiate": true, "auto_reload": "off", "default_sql_output": "auto", "on_cell_change": "autorun", "output_max_bytes": 8000000, "reactive_tests": true, "std_stream_max_bytes": 1000000, "watcher_on_save": "lazy"}, "save": {"autosave": "off", "autosave_delay": 1000, "format_on_save": false}, "server": {"browser": "default", "follow_symlink": false}, "snippets": {"custom_paths": [], "include_default_snippets": true}},
            "configOverrides": {},
            "appConfig": {"sql_output": "auto", "width": "medium"},
            "view": {"showAppCode": false},
            "notebook": null,
            "session": null,
            "runtimeConfig": null,
        };
    </script>
  </body>
</html>
